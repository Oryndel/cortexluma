<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CortexLuma AI â€” Single Page</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts & Highlight.js -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link id="hljs-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <style>
    :root {
        --bg-start: #0f172a;
        --bg-end: #1e293b;
        --text-color: #e2e8f0;
        --chat-box-bg: rgba(15, 23, 42, 0.8);
        --input-bg: #1e293b;
        --input-border: #334155;
        --ai-bubble: #4f46e5;
        --user-bubble: #334155;
        --code-bg: #1e293b;
        --sidebar-bg: #0f172a;
        --shadow-color: rgba(99,102,241,0.15);
    }

    /* LIGHT MODE override */
    .light-mode {
        --bg-start: #f8fafc;
        --bg-end: #e2e8f0;
        --text-color: #1e293b;
        --chat-box-bg: rgba(255,255,255,0.95);
        --input-bg: #ffffff;
        --input-border: #cbd5e1;
        --ai-bubble: #4f46e5;
        --user-bubble: #e2e8f0;
        --code-bg: #f1f5f9;
        --sidebar-bg: #ffffff;
        --shadow-color: rgba(0,0,0,0.08);
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%); 
      color: var(--text-color);
      overflow-y: auto;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 6px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Landing Screen */
    #landing-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    .landing-card {
      width: 100%;
      max-width: 1100px;
      padding: 48px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      text-align: center;
    }
    .landing-title { font-size: 30px; font-weight: 700; color: #c7d2fe; margin-bottom: 8px; }
    .landing-sub { color: #94a3b8; margin-bottom: 18px; }
    .welcome-rotator { font-size: 18px; color: #e2e8f0; height:28px; margin-bottom: 18px; transition: opacity .25s ease; }
    .search-bar { display:flex; gap:10px; align-items:center; justify-content:center; margin-top:6px; }
    .search-input {
      flex:1;
      min-height:58px;
      padding:16px 20px;
      border-radius:999px;
      background:var(--input-bg);
      border:1px solid var(--input-border);
      color:var(--text-color);
      font-size:18px;
      outline:none;
      box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    }
    .search-btn { min-width:58px; height:58px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:#6366f1; border:none; cursor:pointer; box-shadow:0 6px 16px rgba(99,102,241,0.2); color:white; }
    .search-hint { margin-top:14px; color:#94a3b8; font-size:13px; }

    /* App layout */
    .app-wrapper { display:flex; min-height:100vh; gap:0; }
    .sidebar {
      width: 56px;
      padding: 12px;
      background-color: var(--sidebar-bg);
      border-right: 1px solid var(--input-border);
      display:flex;
      flex-direction:column;
      gap:8px;
      transition: width .2s ease;
    }
    .sidebar.expanded { width: 220px; }

    .brand {
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:12px;
    }
    .brand .dot {
      width:36px;
      height:36px;
      border-radius:10px;
      background:linear-gradient(90deg,#6366f1,#a78bfa);
      box-shadow:0 6px 18px rgba(99,102,241,0.18);
    }

    .sidebar button {
      display:flex;
      gap:12px;
      align-items:center;
      padding:10px 12px;
      border-radius:10px;
      background:transparent;
      color:#cbd5e1;
      border:none;
      text-align:left;
      cursor:pointer;
      transition: background .15s ease, color .15s ease;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sidebar button:hover { background: rgba(255,255,255,0.02); color:white; }

    .main-area { flex:1; display:flex; flex-direction:column; align-items:center; padding:26px; }

    .chat-wrapper { width:100%; max-width:980px; display:flex; flex-direction:column; gap:12px; }
    .chat-header { text-align:center; margin-bottom:6px; }
    .chat-box {
      background-color: var(--chat-box-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--shadow-color);
      padding: 16px;
      border-radius: 12px;
      min-height: 360px;
      max-height: 60vh;
      overflow-y: auto;
    }

    .ai-bubble {
      background-color: var(--ai-bubble);
      color: white;
      overflow-wrap: break-word;
      padding: 12px;
      border-radius: 12px;
      display: inline-block;
      max-width: 100%;
      word-break: break-word;
    }
    .user-bubble {
      background-color: var(--user-bubble);
      color: var(--text-color);
      overflow-wrap: break-word;
      padding: 12px;
      border-radius: 12px;
      display: inline-block;
      max-width: 100%;
      word-break: break-word;
    }

    .composer { display:flex; align-items:flex-end; gap:10px; margin-top:10px; width:100%; }
    .composer textarea { flex:1; min-height:44px; max-height:200px; padding:12px 14px; border-radius:12px; background:var(--input-bg); border:1px solid var(--input-border); color:var(--text-color); resize:none; }

    /* image preview container */
    .image-preview-thumb { width:72px; height:72px; object-fit:cover; border-radius:8px; }

    /* code container fixes */
    .code-container pre {
      background-color: var(--code-bg) !important;
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      overflow-x: auto;
      white-space: pre;
      word-break: normal;
      padding: 12px;
    }
    .ai-bubble code { word-break: break-all; white-space: normal; padding:0 4px; border-radius:4px; }

    /* modal overlay */
    .modal-overlay { background-color: rgba(0,0,0,0.7); }
    .modal-content { background-color: var(--input-bg); border:1px solid var(--input-border); color:var(--text-color); }

    /* typewriter placeholder */
    .typewriter-placeholder {
        overflow: hidden; 
        white-space: nowrap; 
        border-right: 3px solid rgba(255,255,255,0.9); 
        width: 12ch;
        animation: typing 1.5s steps(12) infinite, blink-caret 0.75s step-end infinite;
        display:inline-block;
    }
    @keyframes typing { from { width: 0 } to { width: 12ch } }
    @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: rgba(255,255,255,0.9); } }

    /* mic animations */
    #mic-button { transition: transform .2s ease, box-shadow .2s ease; }
    #mic-button:hover { transform: scale(1.05); box-shadow: 0 8px 22px rgba(99,102,241,0.18); }
    #mic-button.recording { background-color: #ef4444 !important; animation: micRecordingPulse 1.2s infinite; }
    @keyframes micRecordingPulse { 0% { box-shadow: 0 0 8px rgba(239,68,68,0.4); } 50% { box-shadow: 0 0 20px rgba(239,68,68,0.9); } 100% { box-shadow: 0 0 8px rgba(239,68,68,0.4); } }

    /* responsive */
    @media (max-width: 920px) {
      .sidebar { width: 56px; position: fixed; bottom: 12px; left: 12px; border-radius: 12px; padding: 10px; }
      .app-wrapper { padding-top: 80px; }
      .landing-card { padding: 20px; }
      .chat-box { max-height: 50vh; }
    }
  </style>
</head>
<body class="fade-page flex min-h-screen">

  <!-- LANDING SCREEN -->
  <div id="landing-screen" class="fade p-4">
    <div class="landing-card">
      <div class="flex items-center justify-between mb-2">
        <div>
          <div class="landing-title">Welcome to <span style="color:#a78bfa">CortexLuma</span></div>
          <div class="landing-sub">Your personal multi-modal assistant â€” ask questions, upload images, or start a chat.</div>
        </div>
        <div class="flex items-center gap-2">
          <!-- mic on landing -->
          <button id="landing-mic" title="Speak" class="p-3 rounded-full bg-slate-700 text-white" style="box-shadow:0 6px 20px rgba(2,6,23,0.6);">
            <svg xmlns="http://www.w3.org/2000/svg" id="landing-mic-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a2 2 0 00-2 2v6a2 2 0 104 0V4a2 2 0 00-2-2zM5 10a5 5 0 0010 0h-2a3 3 0 01-6 0H5z"/></svg>
          </button>
          <button id="go-chat-settings" title="Settings" class="p-3 rounded-full bg-slate-700 text-white" onclick="openSettingsModal()">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.3-.872-2.886-.484-3.535 1.026-.295.708-.18 1.543.5 2.094.64.532.868 1.5.64 2.378-1.123 4.417-.678 6.477 1.353 7.827.844.55 1.761.884 2.65.884h.01c.889 0 1.806-.334 2.65-.884 2.03-1.35 2.475-3.41 1.353-7.827-.228-.878-.003-1.846.64-2.378.68-.551.795-1.386.5-2.094-.649-1.51-2.235-1.9-3.535-1.026a1.532 1.532 0 01-2.286-.948zM10 17a1 1 0 100-2 1 1 0 000 2z"/></svg>
          </button>
        </div>
      </div>

      <div id="welcome-rotator" class="welcome-rotator">Welcome back ðŸ‘‹</div>

      <div class="search-bar mt-2">
        <input id="landing-input" class="search-input" type="text" placeholder="Ask anything â€” e.g. 'Best hotels in Wayanad'">
        <button id="landing-search-btn" class="search-btn" title="Search / Open chat">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="white" viewBox="0 0 20 20"><path d="M10.894 2.559a.578.578 0 0 0-1.188 0l-7.228 14.5A.578.578 0 0 0 3.235 17.5h13.53a.578.578 0 0 0 .587-.446l-7.228-14.5Z" /></svg>
        </button>
      </div>

      <div class="search-hint mt-3">Tip: Press Enter to jump into the chat and send your message automatically. Mic works here too.</div>
    </div>
  </div>

  <!-- MAIN APP (HIDDEN initially) -->
  <div id="main-app" class="app-wrapper hidden" style="opacity:0; transform: translateY(12px);">
    <!-- SIDEBAR -->
    <nav id="sidebar" class="sidebar" aria-label="Sidebar">
      <div class="brand px-2">
        <div class="dot"></div>
        <div class="hidden ml-2">
          <div style="font-weight:700; color:#c7d2fe;">CortexLuma</div>
          <div style="font-size:12px; color:#94a3b8;">v3.3</div>
        </div>
      </div>

      <button id="new-chat-button" onclick="newChat()" class="p-2 rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 transition" title="New Chat">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
          <span class="hidden md:inline">New Chat</span>
        </div>
      </button>

      <button id="search-chat-button" onclick="document.getElementById('chat-search-input')?.focus()" class="p-2 rounded-lg text-slate-300 hover:bg-slate-700 transition" title="Search Chats">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 104 4 4 4 0 00-4-4zm-6 8a8 8 0 1114.32 4.906l3.387 3.387a1 1 0 01-1.414 1.414l-3.387-3.387A8 8 0 012 12z" clip-rule="evenodd"/></svg>
          <span class="hidden md:inline">Search Chats</span>
        </div>
      </button>

      <button class="p-2 rounded-lg text-slate-300 hover:bg-slate-700 transition" onclick="openLibrary()" title="Library">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 5a2 2 0 012-2h2v14H4a2 2 0 01-2-2V5zM8 3h6a2 2 0 012 2v10a2 2 0 01-2 2H8V3z"/></svg>
          <span class="hidden md:inline">Library</span>
        </div>
      </button>

      <button class="p-2 rounded-lg text-slate-300 hover:bg-slate-700 transition" onclick="openProjects()" title="Projects">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3 4a1 1 0 000 2h14a1 1 0 100-2H3zM3 9a1 1 0 100 2h8a1 1 0 100-2H3zM3 14a1 1 0 100 2h6a1 1 0 100-2H3z"/></svg>
          <span class="hidden md:inline">Projects</span>
        </div>
      </button>

      <button class="p-2 rounded-lg text-slate-300 hover:bg-slate-700 transition" onclick="document.getElementById('sidebar-history')?.scrollIntoView()" title="History">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 012 0v2a1 1 0 11-2 0V3zM4 8a1 1 0 000 2h2a1 1 0 100-2H4zM3 12a7 7 0 1114 0v1a1 1 0 11-2 0v-1a5 5 0 10-10 0v1a1 1 0 11-2 0v-1z"/></svg>
          <span class="hidden md:inline">History</span>
        </div>
      </button>

      <div style="flex:1"></div>

      <button id="theme-toggle-button" onclick="toggleTheme()" class="p-2 rounded-lg text-slate-300 hover:bg-slate-700 transition" title="Toggle theme">
        <div class="flex items-center gap-3">
          <span id="theme-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.707A8 8 0 016.207 2.707a8.001 8.001 0 1011.086 11.000z" /></svg>
          </span>
          <span id="theme-text" class="hidden md:inline">Light Mode</span>
        </div>
      </button>

      <button id="settings-button" onclick="openSettingsModal()" class="p-2 rounded-lg text-red-400 hover:bg-slate-700 transition" title="Settings">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" /></svg>
        <span class="hidden md:inline">Model Settings</span>
      </button>

    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-area">
      <div class="chat-wrapper">

        <header class="chat-header">
          <h1 class="text-2xl font-bold" style="color:#c7d2fe;">CortexLuma AI <span style="font-size:12px; color:#94a3b8;">â€” Real-time multi-modal assistant</span></h1>
          <p class="text-sm" style="color:#94a3b8;">Analyze images, ask questions, and get concise answers.</p>
        </header>

        <!-- chat messages container -->
        <div id="chat-messages" class="chat-box"></div>

        <!-- image preview & other utilities -->
        <div id="image-preview-container" class="flex items-center space-x-3 hidden p-2 rounded-lg border" style="background-color: var(--input-bg); border-color: var(--input-border);">
          <span id="image-count-text" class="text-sm font-semibold text-indigo-400">0 Images</span>
          <div id="image-previews" class="flex space-x-2 overflow-x-auto p-1"></div>
          <button type="button" onclick="removeAllImages()" class="text-red-400 hover:text-red-300 transition flex-shrink-0">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
          </button>
        </div>

        <!-- composer form -->
        <form id="chat-form" class="composer" onsubmit="event.preventDefault(); if(!isLoading) getStreamResponse(chatInput.value.trim());">
          <input type="file" id="file-input" accept="image/jpeg, image/png, image/webp" multiple class="hidden" onchange="previewImages(event)">

          <button type="button" id="image-upload-button" onclick="document.getElementById('file-input').click()" class="p-2 rounded-full text-white mr-2 transition" style="background-color: #475569;">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 4-3v2z" clip-rule="evenodd" /></svg>
          </button>

          <textarea id="chat-input" placeholder="Ask a question or upload image(s)..." class="flex-1 p-3 pr-12 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150 overflow-hidden" rows="1" style="min-height:44px; max-height:200px;"></textarea>

          <button type="button" id="mic-button" class="absolute right-28 bottom-4 bg-slate-600 hover:bg-slate-500 text-white p-2 rounded-full transition" title="Click to speak">
            <svg xmlns="http://www.w3.org/2000/svg" id="mic-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 2a2 2 0 00-2 2v6a2 2 0 104 0V4a2 2 0 00-2-2zm-5 6a1 1 0 012 0 3 3 0 006 0 1 1 0 112 0 5 5 0 01-10 0zm5 7a7 7 0 007-7h-2a5 5 0 01-10 0H3a7 7 0 007 7zm-1 2h2v2h-2v-2z"/>
            </svg>
          </button>

          <button type="submit" id="send-button" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-full transition" title="Send">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.559a.578.578 0 0 0-1.188 0l-7.228 14.5A.578.578 0 0 0 3.235 17.5h13.53a.578.578 0 0 0 .587-.446l-7.228-14.5Z" /></svg>
          </button>
        </form>

        <div id="error-message" class="text-red-400 text-sm h-4 mt-2"></div>
      </div>
    </main>
  </div>

  <!-- SETTINGS MODAL -->
  <div id="settings-modal" class="modal-overlay fixed inset-0 hidden items-center justify-center z-50">
    <div class="modal-content w-full max-w-lg p-6 rounded-xl shadow-2xl">
        <div class="flex justify-between items-center mb-4 border-b pb-2" style="border-color: rgba(167,139,250,0.2);">
            <h3 class="text-xl font-bold" style="color:#c7d2fe;">Model Configuration Settings</h3>
            <button onclick="closeSettingsModal()" class="text-slate-400 hover:text-white transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>

        <div class="mb-4">
            <label for="temperature-slider" class="block text-sm font-medium mb-1">Creativity (Temperature): <span id="temperature-value" class="font-bold text-indigo-300">0.7</span></label>
            <input type="range" id="temperature-slider" min="0" max="1" step="0.1" value="0.7" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer range-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <p class="text-xs text-slate-400 mt-1">Lower value is more deterministic/factual (0.0), higher is more creative (1.0).</p>
        </div>

        <div class="mb-4">
            <label for="max-tokens-input" class="block text-sm font-medium mb-1">Maximum Response Length (Tokens):</label>
            <input type="number" id="max-tokens-input" min="128" max="4096" step="128" value="2048" class="w-full p-2 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500" style="background-color: var(--code-bg); border-color: var(--input-border);">
            <p class="text-xs text-slate-400 mt-1">The maximum number of tokens the model can generate (max 4096).</p>
        </div>

        <div class="mb-4">
            <label for="system-instruction-textarea" class="block text-sm font-medium mb-1">AI Personality / System Instruction:</label>
            <textarea id="system-instruction-textarea" rows="3" class="w-full p-2 border rounded-lg resize-none focus:ring-indigo-500 focus:border-indigo-500" style="background-color: var(--code-bg); border-color: var(--input-border);"></textarea>
            <p class="text-xs text-slate-400 mt-1">Define the AI's role, tone, and constraints.</p>
        </div>

        <button onclick="saveSettings(); closeSettingsModal()" class="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition">
            Save Settings
        </button>
    </div>
  </div>

  <!-- END OF HTML, START SCRIPT -->
  <script>
    /**************************************************************************
     *  Full merged script
     *  - Preserves all original features from cortexluma (6).html
     *  - Adds landing screen + mic on landing + auto-submit landing query
     *  - Single-file SPA behavior
     **************************************************************************/

    /* ----------------------- Configs & State ----------------------- */
    const TEXT_STREAM_URL = "https://cortexluma-backend.onrender.com/api/stream-chat"; 
    const MAX_IMAGES = 10; 
    const MAX_FILE_SIZE = 4 * 1024 * 1024; // 4MB limit
    const MAX_PROMPT_LENGTH = 10000;
    const ALLOWED_MIME_TYPES = ['image/jpeg','image/png','image/webp'];

    let isLoading = false;
    let chatHistory = [];
    let uploadedImages = [];
    let modelSettings = {};
    let recognition = null;
    let recognizing = false;

    /* DOM references */
    const landingScreen = document.getElementById('landing-screen');
    const mainApp = document.getElementById('main-app');
    const landingInput = document.getElementById('landing-input');
    const landingBtn = document.getElementById('landing-search-btn');
    const landingMicBtn = document.getElementById('landing-mic');
    const landingMicIcon = document.getElementById('landing-mic-icon');

    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    const sendButton = document.getElementById('send-button');
    const fileInput = document.getElementById('file-input');
    const imagePreviews = document.getElementById('image-previews');
    const imageCountText = document.getElementById('image-count-text');
    const imagePreviewContainer = document.getElementById('image-preview-container');
    const errorMessage = document.getElementById('error-message');

    const themeToggleButton = document.getElementById('theme-toggle-button');
    const settingsModal = document.getElementById('settings-modal');
    const temperatureSlider = document.getElementById('temperature-slider');
    const temperatureValueDisplay = document.getElementById('temperature-value');
    const maxTokensInput = document.getElementById('max-tokens-input');
    const systemInstructionTextarea = document.getElementById('system-instruction-textarea');

    /* ----------------------- Utility Functions ----------------------- */

    function saveHistory() {
      try { localStorage.setItem('cortexLumaHistory', JSON.stringify(chatHistory)); } catch(e) {}
    }
    function loadHistory() {
      try {
        const history = localStorage.getItem('cortexLumaHistory');
        if (history) {
          chatHistory = JSON.parse(history);
          renderHistory();
        } else {
          // initial "assistant" hint bubble when no history found
          chatMessages.innerHTML = `
            <div class="flex justify-start mb-2">
                <div class="ai-bubble p-3 rounded-xl rounded-tl-none max-w-xs md:max-w-xl text-sm shadow chat-bubble">
                    Hey there ðŸ‘‹ Iâ€™m <span class="text-indigo-200 font-semibold">CortexLuma</span>. I can answer questions with up-to-date information and analyze up to ${MAX_IMAGES} images at once! By Vamshi V
                </div>
            </div>
          `;
        }
      } catch(e) {
        console.warn('Failed to load history', e);
      }
    }

    function saveSettings() {
      modelSettings = {
        temperature: parseFloat(temperatureSlider.value),
        maxOutputTokens: parseInt(maxTokensInput.value),
        systemInstruction: systemInstructionTextarea.value.trim(),
      };
      try { localStorage.setItem('cortexLumaSettings', JSON.stringify(modelSettings)); } catch(e) {}
    }

    function loadSettings() {
      const settings = localStorage.getItem('cortexLumaSettings');
      const defaultInstruction = "You are CortexLuma, a powerful, witty, and highly helpful AI assistant built by Vamshi V. You excel at real-time data retrieval and coding tasks. Keep your answers concise, clear, and engaging.";
      modelSettings = settings ? JSON.parse(settings) : { temperature: 0.7, maxOutputTokens: 2048, systemInstruction: defaultInstruction };
      temperatureSlider.value = modelSettings.temperature;
      temperatureValueDisplay.textContent = modelSettings.temperature;
      maxTokensInput.value = modelSettings.maxOutputTokens;
      systemInstructionTextarea.value = modelSettings.systemInstruction || defaultInstruction;
    }

    function setLoadingState(state) {
      isLoading = state;
      sendButton.disabled = state;
      chatInput.disabled = state;
      fileInput.disabled = state;
      errorMessage.textContent = '';
      sendButton.innerHTML = state 
        ? '<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'
        : '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.559a.578.578 0 0 0-1.188 0l-7.228 14.5A.578.578 0 0 0 3.235 17.5h13.53a.578.578 0 0 0 .587-.446l-7.228-14.5Z" /></svg>';
    }

    function estimateTokens(text) {
      return Math.ceil(text.length / 4);
    }

    function clearHistory() {
      if (chatHistory.length > 0 && !confirm("Are you sure you want to clear the conversation history?")) return;
      chatHistory = [];
      localStorage.removeItem('cortexLumaHistory');
      chatMessages.innerHTML = `
        <div class="flex justify-start mb-2">
          <div class="ai-bubble p-3 rounded-xl rounded-tl-none max-w-xs md:max-w-xl text-sm shadow chat-bubble">
            Conversation history cleared! I'm ready for new questions or multi-image analysis.
          </div>
        </div>
      `;
      chatInput.focus();
      removeAllImages();
    }

    function newChat() {
      clearHistory();
    }

    /* ----------------------- Theme Toggle ----------------------- */
    function toggleTheme() {
      const isLight = document.body.classList.contains('light-mode');
      if (isLight) {
        document.body.classList.remove('light-mode');
        localStorage.setItem('cortexLumaTheme','dark');
        document.getElementById('theme-icon').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.707A8 8 0 016.207 2.707a8.001 8.001 0 1011.086 11.000z" /></svg>';
        document.getElementById('theme-text').textContent = 'Light Mode';
        document.getElementById('hljs-theme').href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css';
      } else {
        document.body.classList.add('light-mode');
        localStorage.setItem('cortexLumaTheme','light');
        document.getElementById('theme-icon').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 00-.707-.293h-4a1 1 0 000 2h4a1 1 0 00.707-.293l.707-.707a1 1 0 00-1.414-1.414zM3 10a1 1 0 011-1h1a1 1 0 110 2H4a1 1 0 01-1-1zm14 0a1 1 0 01-1-1h-1a1 1 0 110 2h1a1 1 0 011-1zM7 16a1 1 0 01-1-1v-1a1 1 0 112 0v1a1 1 0 01-1 1zm-3.293-4.707a1 1 0 00-1.414 1.414l.707.707a1 1 0 001.414-1.414l-.707-.707z" clip-rule="evenodd" /></svg>';
        document.getElementById('theme-text').textContent = 'Dark Mode';
        document.getElementById('hljs-theme').href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css';
      }
    }

    /* ----------------------- Modal ----------------------- */
    function openSettingsModal() {
      loadSettings();
      settingsModal.style.display = 'flex';
    }
    function closeSettingsModal() {
      settingsModal.style.display = 'none';
    }

    temperatureSlider.addEventListener('input', (e) => {
      temperatureValueDisplay.textContent = e.target.value;
    });

    /* ----------------------- Image Preview & Multi-image ----------------------- */

    function previewImages(event) {
      const files = Array.from(event.target.files);
      uploadedImages = [];
      imagePreviews.innerHTML = '';

      if (files.length === 0) { removeAllImages(); return; }
      if (files.length > MAX_IMAGES) {
        errorMessage.textContent = `Error: Maximum ${MAX_IMAGES} images allowed.`;
        fileInput.value = '';
        removeAllImages();
        return;
      }

      let validImagesCount = 0;
      files.slice(0, MAX_IMAGES).forEach(file => {
        if (file.size > MAX_FILE_SIZE) {
          errorMessage.textContent = `Error: Image '${file.name}' exceeds 4MB limit and was skipped.`;
          return;
        }
        if (!ALLOWED_MIME_TYPES.includes(file.type)) {
          errorMessage.textContent = `Error: Image '${file.name}' has unsupported type (${file.type}) and was skipped.`;
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          const dataUrl = e.target.result;
          const base64String = dataUrl.split(',')[1];

          uploadedImages.push({ base64: base64String, mimeType: file.type, filename: file.name, dataURL: dataUrl });
          validImagesCount++;

          const img = document.createElement('img');
          img.src = dataUrl;
          img.alt = file.name;
          img.className = 'image-preview-thumb shadow-md';
          imagePreviews.appendChild(img);

          imageCountText.textContent = `${validImagesCount} Images`;
        };
        reader.readAsDataURL(file);
      });

      imagePreviewContainer.classList.remove('hidden');
      errorMessage.textContent = '';
      chatInput.focus();
    }

    function removeAllImages() {
      uploadedImages = [];
      imagePreviewContainer.classList.add('hidden');
      imagePreviews.innerHTML = '';
      imageCountText.textContent = '0 Images';
      fileInput.value = '';
    }

    function base64ToGenerativePart(base64, mimeType) {
      return { inlineData: { data: base64, mimeType } };
    }

    /* ----------------------- Render / History ----------------------- */

    function renderHistory() {
      chatMessages.innerHTML = '';
      chatHistory.forEach(message => {
        const isUser = message.role === 'user';
        const textPart = (message.parts && message.parts.find(p => p.text)) || { text: '' };
        const imageParts = (message.parts) ? message.parts.filter(p => p.inlineData) : [];

        addUserMessageToUI(textPart.text, imageParts, isUser ? false : true);
      });
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Renders a message (can render history or live message)
    function addUserMessageToUI(prompt, imageArray, isHistory = false) {
      const wrapper = document.createElement('div');
      wrapper.className = `flex ${isHistory ? 'justify-start' : 'justify-end'} mb-3`;

      const bubble = document.createElement('div');
      if (isHistory) bubble.innerHTML = renderMarkdown(prompt);
      else bubble.innerText = prompt || (imageArray.length > 0 ? 'Analyzing uploaded image(s)...' : '');

      bubble.className = `p-3 rounded-xl ${isHistory ? 'rounded-tl-none ai-bubble' : 'rounded-br-none user-bubble' } max-w-xs md:max-w-xl text-sm shadow-md`;

      // images
      if (imageArray && imageArray.length > 0) {
        const previewContainer = document.createElement('div');
        previewContainer.className = 'flex space-x-2 mt-2 flex-wrap';
        imageArray.forEach(image => {
          const base64 = isHistory ? image.inlineData.data : image.base64;
          const mimeType = isHistory ? image.inlineData.mimeType : image.mimeType;
          const img = document.createElement('img');
          img.src = `data:${mimeType};base64,${base64}`;
          img.className = 'image-preview-thumb';
          previewContainer.appendChild(img);
        });
        bubble.appendChild(previewContainer);
      }

      wrapper.appendChild(bubble);
      chatMessages.appendChild(wrapper);

      // highlight code blocks in history
      if (isHistory) {
        bubble.querySelectorAll('.code-container pre code').forEach((block) => {
          hljs.highlightElement(block);
        });
      }

      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    /* Markdown rendering with code fences & copy button */
    function renderMarkdown(text) {
      let html = text || '';

      const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
      html = html.replace(codeBlockRegex, (match, lang, code) => {
        const language = lang ? lang.trim() : 'Code';
        return `
          <div class="code-container relative mt-3 mb-3">
            <div class="absolute top-0 right-0 px-2 py-1 text-xs text-indigo-200 rounded-tr-xl rounded-bl-lg z-10 font-mono" style="background-color: var(--ai-bubble); opacity: 0.9;">
                ${language.toUpperCase()}
            </div>
            <button class="copy-button absolute top-0 right-0 mt-8 mr-2 px-2 py-1 text-xs text-white bg-indigo-700 hover:bg-indigo-600 rounded transition duration-150 z-20" onclick="copyCode(this)">
                Copy
            </button>
            <pre style="padding-top: 30px;"><code class="language-${(language||'code').toLowerCase()}">${escapeHtml(code.trim())}</code></pre>
          </div>
        `;
      });

      // inline replacements
      html = html
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/`(.*?)`/g, '<code class="px-1 py-0.5 rounded text-xs" style="background-color: var(--user-bubble); color: #facc15;">$1</code>')
        .replace(/\n/g, '<br>');

      html = html.replace(/<br>\s*(-|\*)\s/g, '<br><span class="inline-block w-2 h-2 rounded-full bg-indigo-400 mr-2 flex-shrink-0 align-middle"></span>');

      return html;
    }

    function escapeHtml(unsafe) {
      return unsafe.replace(/[&<"'>]/g, function(m) {
        switch (m) {
          case '&': return '&amp;';
          case '<': return '&lt;';
          case '>': return '&gt;';
          case '"': return '&quot;';
          case "'": return '&#039;';
          default: return m;
        }
      });
    }

    // copy code helper
    window.copyCode = function(button) {
      try {
        const codeBlock = button.closest('.code-container').querySelector('code');
        const code = codeBlock.innerText;
        navigator.clipboard.writeText(code).then(() => {
          const originalText = button.innerHTML;
          button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 13.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>Copied!';
          setTimeout(() => button.innerHTML = originalText, 1800);
        }).catch(err => { button.innerHTML = 'Err'; });
      } catch(e) { console.error('copy error', e); }
    };

    /* ----------------------- Streaming Response UI ----------------------- */

    function addModelStreamMessage() {
      const startTime = Date.now();

      const wrapper = document.createElement('div');
      wrapper.className = 'flex justify-start mb-3';

      const bubble = document.createElement('div');
      bubble.className = 'ai-bubble p-3 rounded-xl rounded-tl-none max-w-xs md:max-w-xl text-sm shadow-md chat-bubble';
      bubble.innerHTML = `<div class="typewriter-placeholder">Thinking...</div>`;

      wrapper.appendChild(bubble);
      chatMessages.appendChild(wrapper);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      let fullResponseText = '';

      return (chunk, isDone) => {
        const placeholder = bubble.querySelector('.typewriter-placeholder');
        if (placeholder) placeholder.remove();

        if (chunk) {
          fullResponseText += chunk;
          bubble.innerText = fullResponseText;
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        if (isDone) {
          const endTime = Date.now();
          const durationSeconds = ((endTime - startTime) / 1000).toFixed(2);
          const tokenCount = estimateTokens(fullResponseText);

          const footer = document.createElement('div');
          footer.className = 'text-xs text-indigo-200 mt-2 pt-2 border-t';
          footer.style.borderColor = 'rgba(167,139,250,0.12)';
          footer.innerHTML = `Time: ${durationSeconds}s | Est. Tokens: ${tokenCount}`;

          // re-render final markdown into that bubble
          bubble.innerHTML = renderMarkdown(fullResponseText);
          bubble.appendChild(footer);

          bubble.querySelectorAll('.code-container pre code').forEach((block) => {
            hljs.highlightElement(block);
          });
        }
      };
    }

    /* ----------------------- Chat / API Logic ----------------------- */

    async function getStreamResponse(prompt) {
      setLoadingState(true);
      errorMessage.textContent = '';

      // Add user message - show preview images if uploaded
      const userImageParts = uploadedImages.map(img => ({ inlineData: base64ToGenerativePart(img.base64, img.mimeType).inlineData, base64: img.base64, mimeType: img.mimeType }));
      addUserMessageToUI(prompt, userImageParts, false);

      // add to history
      const imagePartsForServer = uploadedImages.map(img => base64ToGenerativePart(img.base64, img.mimeType));
      chatHistory.push({ role: "user", parts: [{ text: prompt }, ...imagePartsForServer] });

      // streaming placeholder
      const responseWriter = addModelStreamMessage();
      let fullResponseText = '';

      try {
        const response = await fetch(TEXT_STREAM_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            history: chatHistory,
            imageParts: imagePartsForServer,
            temperature: modelSettings.temperature || 0.7,
            maxOutputTokens: modelSettings.maxOutputTokens || 2048,
            systemInstruction: modelSettings.systemInstruction || ''
          }),
        });

        if (!response.ok || !response.body) {
          const errorText = await response.text();
          throw new Error(`API Status ${response.status}: ${errorText || 'Request failed to connect to the backend server.'}`);
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let done = false;

        while (!done) {
          const { value, done: doneReading } = await reader.read();
          done = doneReading;
          const chunk = decoder.decode(value, { stream: !done });
          if (chunk) {
            responseWriter(chunk, false);
            fullResponseText += chunk;
          }
        }

        responseWriter(null, true);
        chatHistory.push({ role: "model", parts: [{ text: fullResponseText }] });
        saveHistory();

      } catch (error) {
        console.error('Frontend Error:', error);
        // try to cleanup last user message + placeholder
        if (chatMessages.lastChild) chatMessages.lastChild.remove();
        if (chatHistory.length > 0 && chatHistory[chatHistory.length - 1].role === 'user') {
          chatHistory.pop();
          saveHistory();
        }
        errorMessage.innerHTML = `<span class="font-bold">Error:</span> ${error.message}`;
      } finally {
        setLoadingState(false);
        removeAllImages();
        chatInput.focus();
      }
    }

    /* ----------------------- Landing => Chat Transition ----------------------- */

    const welcomes = [
      "Welcome back ðŸ‘‹",
      "How can I help you today?",
      "Ask anything â€” I'm ready!",
      "Upload images or type a question.",
      "Let's create something amazing!"
    ];
    let welcomeIndex = 0;
    const rotatorEl = document.getElementById('welcome-rotator');

    function rotateWelcome() {
      welcomeIndex = (welcomeIndex + 1) % welcomes.length;
      rotatorEl.style.opacity = 0;
      setTimeout(() => {
        rotatorEl.textContent = welcomes[welcomeIndex];
        rotatorEl.style.opacity = 1;
      }, 250);
    }
    setInterval(rotateWelcome, 3500);

    function showMainApp() {
      // hide landing
      landingScreen.style.transition = 'opacity .45s ease, transform .45s ease';
      landingScreen.style.opacity = 0;
      landingScreen.style.transform = 'translateY(-12px)';
      setTimeout(() => landingScreen.style.display = 'none', 420);

      // show main
      mainApp.classList.remove('hidden');
      setTimeout(() => {
        mainApp.style.opacity = 1;
        mainApp.style.transform = 'translateY(0)';
      }, 50);

      // focus chat input
      setTimeout(() => {
        chatInput.focus();
      }, 520);
    }

    function gotoChatWithQuery(q) {
      if (!q) return;
      showMainApp();
      setTimeout(() => {
        chatInput.value = q;
        chatInput.dispatchEvent(new Event('input'));
        // start streaming automatically
        getStreamResponse(q);
      }, 480);
    }

    landingBtn.addEventListener('click', () => {
      const q = landingInput.value.trim();
      if (!q) { landingInput.focus(); return; }
      gotoChatWithQuery(q);
    });

    landingInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const q = landingInput.value.trim();
        if (!q) return;
        gotoChatWithQuery(q);
      }
    });

    /* ----------------------- Voice Dictation (Landing + Chat) ----------------------- */
    (function initDictation() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
      const landingMic = document.getElementById('landing-mic');
      const landingMicIcon = document.getElementById('landing-mic-icon');
      const chatMic = document.getElementById('mic-button');
      const chatMicIcon = document.getElementById('mic-icon');

      if (!SpeechRecognition) {
        landingMic.title = 'Speech recognition not supported';
        landingMic.disabled = true; landingMic.style.opacity = 0.5;
        chatMic.title = 'Speech recognition not supported';
        chatMic.disabled = true; chatMic.style.opacity = 0.5;
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = 'en-IN';
      recognition.continuous = false;
      recognition.interimResults = true;

      recognition.onstart = () => {
        recognizing = true;
        landingMic.classList.add('recording');
        chatMic.classList.add('recording');
      };

      recognition.onresult = (event) => {
        let transcript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript += event.results[i][0].transcript;
        }
        // If landing is visible, fill landing input; otherwise chat input
        if (landingScreen.style.display !== 'none') {
          landingInput.value = transcript;
        } else {
          chatInput.value = transcript;
          chatInput.style.height = 'auto';
          chatInput.style.height = chatInput.scrollHeight + 'px';
        }
        errorMessage.textContent = '';
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event);
        recognizing = false;
        landingMic.classList.remove('recording');
        chatMic.classList.remove('recording');
        if (event.error === 'not-allowed') {
          errorMessage.textContent = 'Mic access blocked. Allow and retry.';
        } else {
          errorMessage.textContent = 'Speech recognition error.';
        }
      };

      recognition.onend = () => {
        recognizing = false;
        landingMic.classList.remove('recording');
        chatMic.classList.remove('recording');
      };

      landingMic.addEventListener('click', () => {
        if (!recognition) return;
        if (recognizing) { recognition.stop(); recognizing = false; landingMic.classList.remove('recording'); }
        else { recognition.start(); }
      });

      chatMic.addEventListener('click', () => {
        if (!recognition) return;
        if (recognizing) { recognition.stop(); recognizing = false; chatMic.classList.remove('recording'); }
        else { recognition.start(); }
      });

      window.addEventListener('beforeunload', () => { if (recognition && recognizing) recognition.stop(); });
    })();

    /* ----------------------- Chat UI Listeners ----------------------- */
    chatForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const prompt = chatInput.value.trim();
      if (!prompt && uploadedImages.length === 0) {
        errorMessage.textContent = "Please enter a message or upload image(s).";
        return;
      }
      if (prompt.length > MAX_PROMPT_LENGTH) {
        errorMessage.textContent = `Message is too long. Max ${MAX_PROMPT_LENGTH} characters.`;
        return;
      }
      if (!isLoading) {
        getStreamResponse(prompt);
        chatInput.value = '';
        chatInput.style.height = 'auto';
      }
    });

    chatInput.addEventListener('input', () => {
      chatInput.style.height = 'auto';
      chatInput.style.height = (chatInput.scrollHeight) + 'px';
      if (chatInput.value.trim().length > 0) errorMessage.textContent = '';
    });

    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
      }
    });

    /* ----------------------- File Input ----------------------- */
    fileInput.addEventListener('change', previewImages);

    /* ----------------------- Init (load settings, history, theme) ----------------------- */
    document.addEventListener('DOMContentLoaded', () => {
      // Load theme
      const savedTheme = localStorage.getItem('cortexLumaTheme');
      if (savedTheme === 'light') document.body.classList.add('light-mode');

      loadSettings();
      loadHistory();

      // Focus landing input
      landingInput.focus();
    });

    /* ----------------------- Small helpers (Library/Projects) ----------------------- */
    function openLibrary() { alert('Library clicked â€” placeholder'); }
    function openProjects() { alert('Projects clicked â€” placeholder'); }

    /* ----------------------- Accessibility & Misc ----------------------- */
    window.newChat = newChat; // expose for sidebar

    // Allow clicking settings icon on landing
    document.getElementById('go-chat-settings').addEventListener('click', openSettingsModal);

  </script>
</body>
</html>
