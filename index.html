<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CortexLuma AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: radial-gradient(circle at 20% 30%, #1e293b, #020617);
  overflow: hidden;
  position: relative;
  color: #e2e8f0;
}

/* Floating particle animation */
@keyframes floatParticle {
  0% { transform: translateY(0) translateX(0); opacity: 0.4; }
  50% { transform: translateY(-20px) translateX(10px); opacity: 0.8; }
  100% { transform: translateY(0) translateX(0); opacity: 0.4; }
}
.particle {
  position: absolute;
  background: rgba(99,102,241,0.2);
  border-radius: 50%;
  width: 6px; height: 6px;
  animation: floatParticle 6s infinite ease-in-out;
}
.particle:nth-child(1){ top:20%; left:30%; animation-delay:0s;}
.particle:nth-child(2){ top:50%; left:70%; animation-delay:2s;}
.particle:nth-child(3){ top:70%; left:40%; animation-delay:4s;}
.particle:nth-child(4){ top:30%; left:80%; animation-delay:1s;}
.particle:nth-child(5){ top:60%; left:15%; animation-delay:3s;}

/* Scrollbar */
::-webkit-scrollbar{width:8px;}
::-webkit-scrollbar-thumb{background:#475569;border-radius:6px;}
::-webkit-scrollbar-thumb:hover{background:#6366f1;}

/* Chat bubble fade */
@keyframes fadeUp {from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.chat-bubble{animation:fadeUp 0.3s ease-out;}

/* Typing dots */
.typing span {
  display:inline-block;width:6px;height:6px;margin:0 2px;
  background-color:#a5b4fc;border-radius:50%;
  animation:blink 1.4s infinite both;
}
.typing span:nth-child(2){animation-delay:0.2s;}
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes blink{0%,80%,100%{opacity:0.2;transform:translateY(0);}40%{opacity:1;transform:translateY(-3px);}}

/* Header glow */
.header-glow {
  text-shadow:0 0 10px rgba(99,102,241,0.6),0 0 20px rgba(99,102,241,0.3);
  animation:pulseHeader 4s infinite ease-in-out;
}
@keyframes pulseHeader{0%{opacity:1;}50%{opacity:0.8;}100%{opacity:1;}}

/* Chat box style */
.chat-box {
  background:rgba(15,23,42,0.75);
  backdrop-filter:blur(12px);
  border:1px solid rgba(99,102,241,0.15);
  border-radius:1.25rem;
  box-shadow:0 0 30px rgba(99,102,241,0.1);
  transition:box-shadow 0.3s ease;
}
.chat-box:hover {
  box-shadow:0 0 40px rgba(99,102,241,0.2);
}

/* Input focus */
#chat-input:focus {
  border-color:#6366f1;
  box-shadow:0 0 12px rgba(99,102,241,0.4);
}

/* Send button hover */
#send-button:hover{
  transform:scale(1.1);
  box-shadow:0 0 10px rgba(99,102,241,0.6);
}
#send-button:active{transform:scale(0.95);}

/* AI bubble gradient */
.ai-bubble {
  background:linear-gradient(135deg,#475569 0%,#334155 100%);
}
.user-bubble {
  background:linear-gradient(135deg,#6366f1 0%,#4f46e5 100%);
}

/* Page fade-in */
.fade-page {animation:fadePage 0.6s ease-in-out;}
@keyframes fadePage{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>

<body class="fade-page">
<!-- Floating particles -->
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>

<div class="max-w-2xl w-full mx-auto p-4 relative z-10">
  <header class="text-center mb-4">
    <h1 class="text-4xl font-bold text-indigo-400 header-glow">CortexLuma AI</h1>
    <p class="text-slate-400 mt-1">ChatGPT Jr â€” Sleek â€¢ Smart â€¢ Fast âš¡</p>
  </header>

  <div id="chat-messages" class="chat-box p-4 h-[70vh] overflow-y-auto mb-4 flex flex-col space-y-4">
    <div class="flex justify-start">
      <div class="ai-bubble p-3 rounded-xl max-w-xs md:max-w-lg text-sm shadow chat-bubble">
        ðŸ‘‹ Hi, I'm <span class="text-indigo-300 font-semibold">CortexLuma</span> â€” your personal ChatGPT Jr! What shall we explore today?
      </div>
    </div>
  </div>

  <form id="chat-form" class="flex flex-col space-y-2">
    <div class="relative flex items-center">
      <textarea
        id="chat-input"
        class="flex-1 p-3 pr-12 bg-slate-800 border border-slate-700 rounded-lg text-slate-200 resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150 overflow-hidden"
        rows="1"
        placeholder="Type your message..."
        style="min-height:44px;max-height:200px;"
      ></textarea>
      <button
        type="submit"
        id="send-button"
        class="absolute right-3 bottom-2 bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-full transition"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3.105 2.548A2.25 2.25 0 0 0 .5 4.675v9.5c0 1.054.912 1.908 1.996 1.908h.084l.875 1.167a.75.75 0 0 0 1.173.044l.897-.978 10.63-7.589c.866-.62.866-1.927 0-2.547L6.53 1.359a.75.75 0 0 0-1.173.044l-.897.978-.084.108Z" />
          <path d="M10.873 9.75V7.5a.75.75 0 0 0-1.5 0v2.25H6.75a.75.75 0 0 0 0 1.5h2.623v2.25a.75.75 0 0 0 1.5 0v-2.25h2.623a.75.75 0 0 0 0-1.5h-2.623Z" />
        </svg>
      </button>
    </div>
    <div id="error-message" class="text-red-400 text-sm h-4"></div>
  </form>
</div>

    <script>
        
input.addEventListener('input',()=>{
  input.style.height='auto';
  input.style.height=Math.min(input.scrollHeight,200)+'px';
});

form.addEventListener('submit',async(e)=>{
  e.preventDefault();
  const text=input.value.trim();
  if(!text)return;
  addMessage(text,'user');
  input.value='';
  input.style.height='44px';
  // typing
  const typing=document.createElement('div');
  typing.className='flex justify-start';
  typing.innerHTML=`<div class="ai-bubble p-3 rounded-xl max-w-xs md:max-w-lg text-sm chat-bubble typing"><span></span><span></span><span></span></div>`;
  messages.appendChild(typing);
  messages.scrollTop=messages.scrollHeight;
  setTimeout(()=>{
    typing.remove();
    addMessage("âœ¨ Interesting point! Let's unpack that together.",'ai');
  },1600);
});

function addMessage(text,sender){
  const wrap=document.createElement('div');
  wrap.className=sender==='user'?'flex justify-end':'flex justify-start';
  const bubble=document.createElement('div');
  bubble.className=(sender==='user'?'user-bubble':'ai-bubble')+' p-3 rounded-xl max-w-xs md:max-w-lg text-sm shadow chat-bubble';
  bubble.textContent=text;
  wrap.appendChild(bubble);
  messages.appendChild(wrap);
  messages.scrollTop=messages.scrollHeight;
}
     
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const errorMessage = document.getElementById('error-message');
        const sendButton = document.getElementById('send-button');
        const BACKEND_URL = "https://cortexluma-backend.onrender.com/api/chat"; // Your deployed backend URL

        let isLoading = false;

        // --- Helper Functions ---

        function setLoadingState(state) {
            isLoading = state;
            sendButton.disabled = state;
            chatInput.disabled = state;
            errorMessage.textContent = '';
        }

        function addMessage(sender, text) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

            const messageBubble = document.createElement('div');
            // Basic Markdown conversion for simplicity (e.g., **bold**)
            const formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\n/g, '<br>'); // Newlines

            messageBubble.innerHTML = formattedText;
            messageBubble.className = `p-3 rounded-xl max-w-xs md:max-w-lg text-sm shadow-md transition duration-300 ease-in-out ${
                sender === 'user' 
                    ? 'bg-slate-600 rounded-br-none text-slate-100' 
                    : 'bg-indigo-600 rounded-tl-none text-white'
            }`;

            messageWrapper.appendChild(messageBubble);
            chatMessages.appendChild(messageWrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLoadingIndicator() {
            const indicatorWrapper = document.createElement('div');
            indicatorWrapper.id = 'loading-indicator';
            indicatorWrapper.className = 'flex justify-start';

            const indicator = document.createElement('div');
            indicator.className = 'bg-indigo-600 p-3 rounded-xl rounded-tl-none max-w-xs md:max-w-lg text-sm shadow-md';
            indicator.innerHTML = '<div class="flex space-x-1"><span class="animate-pulse">.</span><span class="animate-pulse delay-75">.</span><span class="animate-pulse delay-150">.</span></div>';
            
            indicatorWrapper.appendChild(indicator);
            chatMessages.appendChild(indicatorWrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoadingIndicator() {
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // --- Main Function ---

        async function getAiResponse(prompt) {
            setLoadingState(true);
            addLoadingIndicator();

            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: prompt }),
                });

                removeLoadingIndicator();

                if (!response.ok) {
                    const errorDetails = await response.json().catch(() => ({ error: 'Unknown Upstream API error' }));
                    // If the backend returns 502 (Upstream API error), show the details it provided
                    if (response.status === 502) {
                         // IMPORTANT: This is where the 404 from Gemini API is captured
                         // The text in the image confirms this happens when the backend gets the 404
                        throw new Error(`Upstream API error (Status ${errorDetails.status}). Check your backend logs for the Gemini API model ID issue.`);
                    } else {
                        throw new Error(`Backend Status ${response.status}: ${errorDetails.error || 'Request failed'}`);
                    }
                }

                const data = await response.json();
                const aiResponse = data.reply;

                if (aiResponse) {
                    addMessage('ai', aiResponse);
                } else {
                    throw new Error('Received an empty reply from the backend.');
                }

            } catch (error) {
                console.error('Backend Error:', error);
                removeLoadingIndicator();
                errorMessage.innerHTML = `<span class="font-bold">Error:</span> ${error.message}`;
            } finally {
                setLoadingState(false);
                chatInput.focus();
            }
        }

        // --- Event Listeners ---
        
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const prompt = chatInput.value.trim();
            if (prompt && !isLoading) {
                addMessage('user', prompt);
                getAiResponse(prompt);
                chatInput.value = '';
                chatInput.style.height = 'auto';
            }
        });
        
        chatInput.addEventListener('input', () => {
            // Auto-resize textarea
            chatInput.style.height = 'auto';
            chatInput.style.height = (chatInput.scrollHeight) + 'px';
        });

        chatInput.addEventListener('keydown', (e) => {
            // Send on Enter, but allow newline with Shift+Enter
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });

    </script>
</body>
</html>
